# 아파치 설정

1. Timeout 300
2. MaxKeepAliveRequest 100
3. DirectoryIndex index.htm, index.html, index.php
4. ErrorLog "경로"


1 클라이언트와 서버 간에 300초 동안 아무런 메시지가 발생하지 않으면 타임아웃을 시키고 연결을 끊음

2 KeepAlive 값이 On인 경우 클라이언트와 연결된 작업의 최대 개수를 100개로 제한함. 

해당 회수를 초과하면 현재 프로세스는 종료하고 다른 프로세스가처리함

3 웹 디렉토리 접근 시 인식되는 파일의 순서를 index.htm, index.html, index.php 순으로 지정함

4 Error 발생 시 로그 파일의 위치를 지정함


1. 웹 서버 설정파일 주요지시자

ServerRoot "/etc/httpd"

웹서버가 설치된 최상위 디렉터리 경로를 지정한다. 해당 경로에는 설정파일, 로그파일, 모듈 등이 위치한다.

Listen 80

클라이언트가 접속할 웹서버의 리스닝 포트를 지정한다.

ServerTokens Prod

HTTP 응답 시 헤더의 Server 필드를 통해

보안상 최소한의 정보만을 제공하는 Prod로 설정할 것을 권장(웹서버 종류만 노출)

ServerSignature Off

웹서버에서 직접 생성하는 에러 메시지, 디렉터리 리스팅 메시지 등에 웹서버, OS, 모듈 등의 정보를 제공할지 여부를 지정한다.

보안상 정보를 제공하지 않는 Off 설정을 권장

DocumentRoot "/var/www/html"

웹 어플리케이션 자원(웹 문서)들이 위치하는 최상위 디렉터리를 설정한다.

클라이언트 요청 URL상에 명시되는 최상위 디렉터리가 Document Root 디렉터리를 의미한다.

DirectoryIndex index.php index.html

클라이언트가 디렉터리만 명시하여 요청한 경우 이를 처리할 자원 목록을 지정한다.

명시한 순서대로 해당 자원을 검색하고 최종적으로 해당 자원이 없으면 파일 목록을 반환하거나

(디렉터리 인덱싱 기능을 사용하는 경우) 에러 메시지를 반환한다.

위 설정에서는 클라이언트의 디렉터리만 명시한 URL 호출에 대하여 해당 디렉터리에 index.php 파일이 있는지 검색하고

없으면 index.html 파일을 검색한다.

2. 타임아웃 관련 설정

Timeout 120

클라이언트의 요청에 의해 서버와 연결이 된 후 클라이언트와 서버 간에 아무런 메시지가 발생할지 않을 동안의

대기 시간으로 초단위로 지정한다.

KeepAlive On

클라이언트와 서버 프로세스간의 연결을 일정 조건에 따라 지속시켜 동일한 연결을 통해 동일 클라이언트의 다수 요청을

처리하는 기능의 사용 여부를 지정한다.

MaxKeepAliveRequests 100

KeepAlive 기능 사용 시(KeepAlive On) 클라이언트와 서버 프로세스 간에 연결을 지속시키는 동안에 허용할 최대 요청 건수를 지정한다.

해당 요청 건수를 초과하면 연결을 종료한다.

KeepAliveTimeout 15

keepAlive 기능 사용 시(KeepAlive On) 클라이언트와 서버 프로세스 간에 연결을 지속시키는 동안에 클라이언트의 마지막 요청 이후

다음 요청을 대기하는 시간(초 단위)을 지정한다.

 해당 시간동안 클라이언트의 추가 요청이 발생하지 않으면 연결을 종료한다.

RequestReadTimeout header=5, body=10

클라이언트로부터 요청 메시지의 헤더부와 바디부를 모두 수신하는 시간에 대한 타임아웃을 지정한다.

지정한 시간 동안에 요청 메시지의 헤더부와 바디부를 모두 수신하지 못한 경우에는 408에러 응답 메시지를 반환한다.

클라이언트 요청에 대한 세부적인 제한을 설정하기 위한 목적의 지시자이며 특히,

Slow 계열의 HTTP 도스 공격(Slow HTTP Header, Slow HTTP POST)에 효과적으로 대응할 수 있다.

3. 로그 관련 설정

ErrorLog logs/error_log

에러 로그파일의 경로를 지정한다. 에러 로그파일에는 웹서버 구동 중 발생하는 에러 및 디버깅 메시지 등이 남는다.

상대경로는 웹서버 설치 최상위 디렉터리(ServerRoot)를 기준으로한 경로를 의미한다.

CustomLog logs/access_log combined

4. 로그 분석

접속기록을 저장하기 위한 로그파일의 경로를 지정한다.

클라이언트가 웹서버에 접속하면 클라이언트와 웹서버 간에는 요청과 응답이 지속적으로 발생한다.

이때 클라이언트의 요청에 의해 웹서버가 응답한 내용은 액세스 로그라는 파일에 기록되고

클라이언트 요청에 의해 웹서버에 오류가 발생했을 경우 에러로그에 기록된다.

일반적으로 액세스 로그와 에러로그 두 가지를 웹 로그라고 부른다.

웹 로그 분석 목적

접속 사용자의 행위/취향등을 분석

보안사고 발생 시 추적할 수 있는 증거자료

보안사고 발생 전 이상 징후, 해킹시도, 해킹 성공 여부를 확인

다양한 웹 공격 패턴 파악

접속 시간, 접근 파일 정보, 사용자 정보, 요청 방식, 성공여부 등을 확인

