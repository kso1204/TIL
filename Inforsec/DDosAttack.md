# DDos

https://blog.naver.com/stereok2/221425992055

일반적인 공격 구조
공격자 : C&C 서버에 공격 명령을 전달하는 해커의 컴퓨터를 말한다. 봇 마스터라고도 한다.

명령제어(C&C:Command & Control 서버) : 공격자로부터 직접 공격 명령을 전달받는 시스템을 말하며 전달받은 명령은 관리하는 다수의 좀비 PC/디바이스(악성 봇)에게 전달한다. 마스터(Master)라고도 한다.

좀비(Zombie) PC/디바이스 : C&C 서버로부터 전달받은 명령을 실행하여 공격대상에 실제 공격을 수행하는 PC/디바이스를 말한다.
봇, 슬레이브, 에이전트라고도 한다.

공격대상: 공격의 대상이 되는 시스템을 말한다.

봇넷이란 악성 소프트웨어인 봇에 감염된 다수의 좀비 PC/디바이스로 구성된 네트워크를 말한다.

봇넷은 명령/제어를 위해 사용하는 프로토콜에 따라 IRC 봇넷, HTTP 봇넷, P2P 봇넷으로 분류할 수 있으며 네트워크 구성에 따라 중앙 집중형 방식(IRC, HTTP), 분산형 방식(P2P)으로 구분할 수 있다.


# 네트워크 대역폭 소진 공격

1. UDP Flooding 공격

공격자는 다량의 UDP 패킷을 서버로 전송하여 서버가 보유한 네트워크 대역폭을 소진시켜 다른 정상적인 클라이언트의 접속을 원활하지 못하도록 유발시키는 공격

2. ICMP Flooding 공격

공격자는 다량의 ICMP 패킷을 서버로 전송하여 서버가 보유한 네트워크 대역폭을 소진시켜 다른 정상적인 클라이언트의 접속을 원활하지 못하도록 유발시키는 공격

# 서버/서비스 자원 소진 공격

1. TCP SYN Flooding 공격

TCP 연결 설정 과정의 취약점을 이용한 공격으로 공격대상 시스템의 TCP 연결 자원을 소진시켜 외부로부터 TCP 연결 요청을 받을 수 없는 상태로 만드는 서비스 거부 공격이다.

SYN -> SYN + ACK -> ACK 답변을 줘야 하는데

답변을 주지 않고 SYN_RECV 상태를 유지시키는 것(ACK 응답을 대기하고 있다)

출발지 IP를 위조해서 ACK 응답을 못 주게하는 것

대응책

완전한 3-way handshaking이 이루어지지 않는다면 backlog queue(연결요청 대기큐)가 소비되지 않도록 설정한다. 대표적으로 Syn Cookie 설정을 이용할 수 있다.

방화벽 또는 DDoS 대응장비를 이용하여 동일 client(IP)의 연결(SYN)요청에 대한 임계치(Threshold) 설정을 통해 과도한 연결요청이 발생하는 것을 차단한다. 

backlog Queue의 크기를 늘려준다. (임시적)

syn + ack에 대한 대기 시간을 줄인다 (너무 줄이면 정상 연결도 거부)

first syn drop 설정을 한다. 연결 요청 패킷을 보내는 클라이언트가 실제로 존재하는지를 파악하는 방법으로 첫 번째 SYN을 drop한다. 대부분의 공격툴이 패킷 drop시 재전송을 수행하지 않는다는 점을 이용

2. HTTP GET Flooding 공격

공격자가 동일한 동적 컨텐츠에 대한 HTTP/GET 요청을 다량으로 발생시켜 공격대상 웹서버가 해당 요청을 처리하기 위해 서버 자원을 과도하게 사용하도록 하여 정상적인 요청을 처리하지 못하도록 하는 서비스 거부 공격이다.

3. Hulk DoS 공격

HTTP GET Flooding 공격과 동일하게 다량의 HTTP/GET 요청을 하지만 공격대상 주소를 조금씩 변경시킨다. (쿼리스트링 부분을 변경해서 임계치기반의 디도스 대응 장비를 우회하기 위함)

4. Hash DoS 공격

웹서버는 클라이언트 HTTP 요청을 통해 전달되는 파라미터를 효율적으로 저장하고 검색하기 위한 자료구조로 해시테이블을 주로 사용한다.

공격자는 이러한 특성을 악용하여 조작된 많은 수의 파라미터를 POST 방식으로 웹서버로 전달, 웹서버는 다수의 해시 충돌이 발생하게 되고 결과적으로 정상적인 파라미터 조회 시 많은 CPU자원을 소모하게 된다. 이러한 방식의 서비스 거부 공격을 Hash DoS라고 한다.

# Slow 계열 공격유형 실습

1. Slow HTTP Header DoS(Slowloris) 공격

HTTP 요청 메시지는 요청 라인, 요청 헤더, 빈라인, 메시지 바디로 구성되어 있다. 개행은 CRLF를 의미하는 것으로 16진수값으로 0X0d0a로 표현한다.

공격자가 만약 요청 헤더의 끝, 즉 빈 라인을 전달하지 않고 지속적으로 천천히 불필요한 헤더 필드 정보를 전달하면 웹서버는 요청 헤더부를 모두 수신해야 요청 메시지 처리가 가능하기 때문에 이를 모두 수신할 때까지 연결 상태를 유지하면서 대기하게 된다. 

2. Slow HTTP POST DoS(RUDY) 공격

기본적으로 웹서버는 content-type 헤더 필드를 참고해서 데이터의 유형을 파악하고, content-length 헤더 필드를 참고해서 데이터의 길이를 파악한 후 해당 데이터의 길이만큼 읽어 들이는 작업을 수행한다.

공격자는 content-length를 비정상적으로 크게 설정한 후 매우 소량의 데이터를 지속적으로 천천히 웹서버에 전송하면 웹서버는 content-length 헤더필드에 명시된 크기만큼 데이터를 모두 수신하기 위해 연결 상태를 유지하면서 대기하게 된다.

3. Slow HTTP Read DoS 공격

TCP의 흐름제어란 연결된 상호간에 수신 가능한 양만큼만 데이터를 전송하는 제어방식을 의미한다.

공격자는 이러한 TCP 흐름 제어 특성을 이용해서 HTTP 요청을 보낸 후 window 크기를 조작하여 0인 "Zero Window Packet"을 지속적으로 서버측에 전달하여 서버가 요청에 대한 응답 메시지를 전송하지 못하고 연결을 지속적으로 유지하도록 한다.

# DoS

1. Smurf 공격 원리 및 대응 방법

- 원리 : 공격자가 출발지 IP를 희생자IP로 위조(Spoofing)한 후 증폭 네트워크로 ICMP Echo request를 브로드캐스트하여,
다수의 ICMP Echo reply가 희생자에게 전달되어 서비스를 마비시키게 됨

-대응방법
1.1) 동일한 ICMP Echo reply 패킷이 발생하는 경우 IPS(침입차단시스템)을 통해 모두 차단(Drop)

1.2) 다른 네트워크로부터 자신의 네트워크로 들어오는 Directed Broadcast 패킷을 허용하지 않도록 라우터 설정(no ip directed-broadcast)

1.3) 브로드캐스트 주소로 전송된 ICMP Echo request 메시지에 응답하지 않도록 시스템 설정


2. Ping of Death 공격

Ethernet의 경우 1500 bytes, 즉 IP 패킷의 최대 크기가 1500 bytes이기 때문에 IP 헤더부(기본 20bytes)를 제외하면 ICMP 패킷은 최대 1480 bytes의 크기로 생성된다. 

Ping 패킷의 데이터 크기를 매우 크게 하여 패킷을 몇 개만 보내도 수십 개로 분할하여 목적지로 송신되는 것이다.
보통의 ICMP 패킷은 분할하지 않으므로 패킷 중 분할이 일어난 패킷을 공격으로 의심하여 탐지하는 방식을 사용한다.

현재는 일정 수 이상의 ICMP 패킷을 받으면 무시하게 설정

3. Land Attack

출발지 IP와 목적지 IP가 같은 패킷을 만들어 보냄으로써 수신자가 자기 자신에게 응답을 보내게 하여 시스템의 가용성을 침해하는 공격

방화벽에서는 출발지 IP와 목적지 IP가 같으면 무조건 DROP시킨다.

4. Teardrop Attack

IP 패킷의 재조합 과정에서 잘못된 fragment offset 정보로 인해 수신시스템이 문제를 발생하도록 만드는 DoS 공격을 말한다.

공격자는 IP fragment offset값을 서로 중첩되도록 조작하여 전송하고 이를 수신한 시스템이 재조합하는 과정에서 오류가 발생, 시스템의 기능을 마비시키는 공격

비슷한 공격은 bonk, boink가 있다.

IP fragmentaion 취약점을 이용한 IDS 우회 공격도 있는데 이건 DoS 공격이 아니다.

Tiny Fragment - ip헤더 보다 작은 fragment를 만들어서 내부 시스템에 침입하는 공격

Fragment Overlap - ip fragment의 offset값을 조작해 서비스 포트 필드를 중첩시켜서 재조합이 되고 나면 침입차단시스템(방화벽)에서 허용하지 않는 서비스에 접근 가능하게 만드는 공겨기법

OS의 보안패치를 모두 설치하여 OS의 취약점 해소
